<!-- frontend/backtest.html -->
<!DOCTYPE html>
<html>
<head>
    <title>Backtest Results Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .dashboard {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .metrics-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        .metric-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .metric-title {
            font-size: 14px;
            color: #666;
            margin-bottom: 5px;
        }
        .metric-value {
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }
        .metric-value.positive {
            color: #28a745;
        }
        .metric-value.negative {
            color: #dc3545;
        }
        .trades-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .trades-table th, .trades-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        .trades-table th {
            background: #f8f9fa;
            font-weight: bold;
        }
        .trades-table tr:hover {
            background: #f8f9fa;
        }
        .profit {
            color: #28a745;
        }
        .loss {
            color: #dc3545;
        }
    </style>
</head>
<body>
    <h1>Backtest Results Dashboard</h1>
    <div class="dashboard">
        <div class="chart-container">
            <canvas id="equityChart"></canvas>
        </div>
        <div class="metrics-container">
            <div class="metric-card">
                <div class="metric-title">Total Return</div>
                <div id="totalReturn" class="metric-value">-</div>
            </div>
            <div class="metric-card">
                <div class="metric-title">Win Rate</div>
                <div id="winRate" class="metric-value">-</div>
            </div>
            <div class="metric-card">
                <div class="metric-title">Profit Factor</div>
                <div id="profitFactor" class="metric-value">-</div>
            </div>
            <div class="metric-card">
                <div class="metric-title">Max Drawdown</div>
                <div id="maxDrawdown" class="metric-value">-</div>
            </div>
            <div class="metric-card">
                <div class="metric-title">Sharpe Ratio</div>
                <div id="sharpeRatio" class="metric-value">-</div>
            </div>
            <div class="metric-card">
                <div class="metric-title">Total Trades</div>
                <div id="totalTrades" class="metric-value">-</div>
            </div>
        </div>
    </div>

    <div class="chart-container">
        <canvas id="monthlyReturns"></canvas>
    </div>

    <div class="chart-container">
        <h2>Recent Trades</h2>
        <table class="trades-table">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Type</th>
                    <th>Entry Price</th>
                    <th>Exit Price</th>
                    <th>P/L</th>
                </tr>
            </thead>
            <tbody id="tradesBody">
            </tbody>
        </table>
    </div>

 <!-- frontend/backtest.html (continuation) -->
<script>
    // Monthly returns chart update
    monthlyChart.data.labels = data.monthly_returns.map(m => m.date);
    monthlyChart.data.datasets[0].data = data.monthly_returns.map(m => m.return);
    monthlyChart.data.datasets[0].backgroundColor = data.monthly_returns.map(m => 
        m.return >= 0 ? 'rgba(40, 167, 69, 0.2)' : 'rgba(220, 53, 69, 0.2)'
    );
    monthlyChart.data.datasets[0].borderColor = data.monthly_returns.map(m => 
        m.return >= 0 ? '#28a745' : '#dc3545'
    );
    monthlyChart.update();

    // Update metrics
    document.getElementById('totalReturn').textContent = 
        `${data.metrics.total_return.toFixed(2)}%`;
    document.getElementById('totalReturn').className = 
        `metric-value ${data.metrics.total_return >= 0 ? 'positive' : 'negative'}`;

    document.getElementById('winRate').textContent = 
        `${(data.metrics.win_rate * 100).toFixed(2)}%`;

    document.getElementById('profitFactor').textContent = 
        data.metrics.profit_factor.toFixed(2);

    document.getElementById('maxDrawdown').textContent = 
        `${data.metrics.max_drawdown.toFixed(2)}%`;

    document.getElementById('sharpeRatio').textContent = 
        data.metrics.sharpe_ratio.toFixed(2);

    document.getElementById('totalTrades').textContent = 
        data.metrics.total_trades;

    // Update trades table
    const tradesBody = document.getElementById('tradesBody');
    tradesBody.innerHTML = '';
    
    // Show last 10 trades
    const recentTrades = data.trades.slice(-10).reverse();
    recentTrades.forEach(trade => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${moment(trade.exit_date).format('YYYY-MM-DD HH:mm')}</td>
            <td>${trade.type.toUpperCase()}</td>
            <td>${trade.entry_price.toFixed(5)}</td>
            <td>${trade.exit_price.toFixed(5)}</td>
            <td class="${trade.pnl >= 0 ? 'profit' : 'loss'}">
                ${trade.pnl.toFixed(2)}
            </td>
        `;
        tradesBody.appendChild(row);
    });

} catch (error) {
    console.error('Error updating dashboard:', error);
}
}

// Update every 5 seconds
setInterval(updateDashboard, 5000);
updateDashboard();
</script>

<!-- Add drawdown analysis section -->
<div class="chart-container">
    <h2>Drawdown Analysis</h2>
    <canvas id="drawdownChart"></canvas>
</div>

<script>
const drawdownCtx = document.getElementById('drawdownChart').getContext('2d');
const drawdownChart = new Chart(drawdownCtx, {
    type: 'line',
    data: {
        labels: [],
        datasets: [{
            label: 'Drawdown %',
            data: [],
            borderColor: 'rgb(220, 53, 69)',
            fill: true,
            backgroundColor: 'rgba(220, 53, 69, 0.1)'
        }]
    },
    options: {
        responsive: true,
        plugins: {
            title: {
                display: true,
                text: 'Drawdown Over Time'
            }
        },
        scales: {
            y: {
                reverse: true,
                beginAtZero: true,
                title: {
                    display: true,
                    text: 'Drawdown %'
                }
            }
        }
    }
});

// Add performance analytics tabs
const performanceTabs = `
<div class="chart-container">
    <div class="tabs">
        <button class="tab-btn active" onclick="showTab('daily')">Daily</button>
        <button class="tab-btn" onclick="showTab('monthly')">Monthly</button>
        <button class="tab-btn" onclick="showTab('yearly')">Yearly</button>
    </div>
    <div id="dailyTab" class="tab-content active">
        <canvas id="dailyReturns"></canvas>
    </div>
    <div id="monthlyTab" class="tab-content">
        <canvas id="monthlyDistribution"></canvas>
    </div>
    <div id="yearlyTab" class="tab-content">
        <canvas id="yearlyPerformance"></canvas>
    </div>
</div>
`;

document.body.insertAdjacentHTML('beforeend', performanceTabs);

// Initialize performance charts
const dailyReturnsChart = new Chart(
    document.getElementById('dailyReturns').getContext('2d'),
    {
        type: 'scatter',
        data: {
            datasets: [{
                label: 'Daily Returns',
                data: [],
                backgroundColor: 'rgba(75, 192, 192, 0.5)'
            }]
        },
        options: {
            responsive: true,
            plugins: {
                title: {
                    display: true,
                    text: 'Daily Returns Distribution'
                }
            },
            scales: {
                x: {
                    type: 'time',
                    time: {
                        unit: 'day'
                    }
                }
            }
        }
    }
);

// Add styles for tabs
const styles = `
<style>
.tabs {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
}

.tab-btn {
    padding: 10px 20px;
    border: none;
    background: #f8f9fa;
    cursor: pointer;
    border-radius: 4px;
}

.tab-btn.active {
    background: #007bff;
    color: white;
}

.tab-content {
    display: none;
}

.tab-content.active {
    display: block;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 15px;
    margin-top: 20px;
}

.stats-card {
    background: white;
    padding: 15px;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.stats-title {
    font-size: 14px;
    color: #666;
    margin-bottom: 5px;
}

.stats-value {
    font-size: 18px;
    font-weight: bold;
    color: #333;
}
</style>
`;

document.head.insertAdjacentHTML('beforeend', styles);
</script>
</body>
</html>